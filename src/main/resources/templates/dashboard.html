<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Employee Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

<div class="container mt-5">
    <h1 class="text-center text-primary mb-4">Employee Dashboard</h1>

    <!-- ROW 1 -->
    <div class="row mb-4">
        <!-- Average Salary -->
        <div class="col-md-6">
            <div class="card p-4 shadow bg-white">
                <h5 class="card-title text-center">Average Salary</h5>

                <h3 class="text-center"
                    th:text="${avgSalary != null ? T(java.lang.String).format('%.2f', avgSalary) : '0.00'}">
                    0.00
                </h3>
            </div>
        </div>

        <!-- Dept Count Pie Chart -->
        <div class="col-md-6">
            <div class="card p-4 shadow bg-white">
                <h5 class="card-title text-center">Employees by Department</h5>
                <canvas id="deptChart"></canvas>
            </div>
        </div>
    </div>

    <!-- ROW 2 -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card p-4 shadow bg-white">
                <h5 class="card-title text-center">Department-wise Average Salary</h5>
                <canvas id="deptSalaryChart"></canvas>
            </div>
        </div>
    </div>

    <div class="text-center mt-3">
        <a th:href="@{/}" class="btn btn-secondary">Back to Employee List</a>
    </div>
</div>

<!-- CHART JS SCRIPT -->
<script th:inline="javascript">
/*<![CDATA[*/

    // Convert Maps to JS Arrays
    const deptLabels = /*[[${deptCount != null ? deptCount.keySet() : {}}]]*/ [];
    const deptData   = /*[[${deptCount != null ? deptCount.values() : {}}]]*/ [];

    const ctxDept = document.getElementById('deptChart').getContext('2d');
    new Chart(ctxDept, {
        type: 'pie',
        data: {
            labels: deptLabels,
            datasets: [{
                data: deptData,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.7)',
                    'rgba(54, 162, 235, 0.7)',
                    'rgba(255, 206, 86, 0.7)',
                    'rgba(75, 192, 192, 0.7)',
                    'rgba(153, 102, 255, 0.7)',
                    'rgba(255, 159, 64, 0.7)'
                ]
            }]
        }
    });

    // Department Average Salary
    const deptSalaryLabels = /*[[${deptAvgSalary != null ? deptAvgSalary.keySet() : {}}]]*/ [];
    const deptSalaryData   = /*[[${deptAvgSalary != null ? deptAvgSalary.values() : {}}]]*/ [];

    const ctxDeptSalary = document.getElementById('deptSalaryChart').getContext('2d');
    new Chart(ctxDeptSalary, {
        type: 'bar',
        data: {
            labels: deptSalaryLabels,
            datasets: [{
                label: 'Average Salary',
                data: deptSalaryData,
                backgroundColor: 'rgba(54, 162, 235, 0.7)'
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });

/*]]>*/
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
